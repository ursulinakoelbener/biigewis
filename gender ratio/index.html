<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Geschlechteranteile</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      margin: 40px;
    }
    svg {
      max-width: 800px;
      height: auto;
    }
  </style>
</head>
<body>
  <h2>Geschlechteranteile Standeskommission Appenzell I.Rh.</h2>
  <svg></svg> 

  <script>
  const svg = d3.select("svg")
    .attr("width", 900)
    .attr("height", 2000);

  const tooltip = d3.select("body").append("div")
    .style("position", "absolute")
    .style("background", "#fff")
    .style("padding", "6px 10px")
    .style("border", "1px solid #ccc")
    .style("border-radius", "6px")
    .style("pointer-events", "none")
    .style("display", "none");

  const circleRadius = 12;
  const spacing = 40;
  const rowSpacing = 40;
  const offsetX = 150;
  const offsetY = 50;
  const offsetBottom = 50;

  const circleDelay = 150;
  const yearDelay = 800;

  d3.dsv(";", "standeskommission.csv").then(data => {
    // Jahre sortieren: ältestes Jahr unten
    const grouped = Array.from(d3.group(data, d => d.Jahr))
      .sort((a, b) => d3.descending(+a[0], +b[0]));

    // Separate Liste für Animation-Reihenfolge (nur Jahre ab 2020, aufsteigend)
    const animationOrder = grouped
      .filter(([jahr]) => +jahr >= 2020)
      .sort((a, b) => d3.ascending(+a[0], +b[0]));

    grouped.forEach(([jahr, personen], rowIndex) => {
      const yPosition = offsetY + rowIndex * rowSpacing;

      const drawCircle = (d, i) => {
        const circle = svg.append("circle")
          .attr("cx", offsetX + i * spacing)
          .attr("cy", d.Jahr >= 2020 ? offsetY - 100 : yPosition)
          .attr("r", circleRadius)
          .attr("fill", d.Geschlecht === "f" ? "#fde725" : "#21918c")
          .attr("stroke", d.Funktion.includes("Regierender Landammann") ? "#000" : "none")
          .attr("stroke-width", d.Funktion.includes("Regierender Landammann") ? 2 : 0)
          .on("mouseover", (event) => {
            tooltip
              .style("display", "block")
              .html(`<strong>${d.Vorname} ${d.Nachname}</strong><br/>
                     ${d.Funktion}<br/>
                     ${d.Departement}`);
          })
          .on("mousemove", event => {
            tooltip
              .style("left", (event.pageX + 10) + "px")
              .style("top", (event.pageY - 20) + "px");
          })
          .on("mouseout", () => {
            tooltip.style("display", "none");
          });

        if (d.Jahr >= 2020) {
          circle.transition()
            .delay(i * circleDelay)
            .duration(600)
            .ease(d3.easeBounceOut)
            .attr("cy", yPosition);
        }
      };

      if (jahr >= 2020) {
        
        // Finde Animation-Index basierend auf aufsteigender Reihenfolge
        const animationRowIndex = animationOrder.findIndex(([y]) => y === jahr);

        setTimeout(() => {
          // Zeige Jahreszahl mit Kreisen
          svg.append("text")
            .attr("x", offsetX - 100)
            .attr("y", yPosition + 5)
            .attr("opacity", 0)
            .text(jahr)
            .attr("font-size", "14px")
            .transition()
            .duration(500)
            .attr("opacity", 1);

          personen.forEach((d, i) => drawCircle(d, i));
        }, animationRowIndex * (personen.length * circleDelay + yearDelay));
      } else {
        // Ältere Jahre sofort anzeigen
        svg.append("text")
          .attr("x", offsetX - 100)
          .attr("y", yPosition + 5)
          .text(jahr)
          .attr("font-size", "14px");

        personen.forEach((d, i) => drawCircle(d, i));
      }
    });
  });
</script>

</body>
</html>
